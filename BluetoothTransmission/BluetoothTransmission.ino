char *mockdata[] = {
  "1,-50.45,-2.09,77.36",
"2,-19.03,53.13,175.6",
"3,164.83,-49.06,-33.26",
"4,152.43,81.6,-132.43",
"5,-123.0,41.74,151.25",
"6,-142.91,-45.83,172.49",
"7,67.52,-65.01,-169.52",
"8,-123.81,-72.67,-112.96",
"9,-76.78,40.31,142.68",
"10,36.57,-38.43,91.48",
"11,118.05,-30.82,158.1",
"12,-148.22,-71.34,129.53",
"13,-79.27,-45.29,-83.75",
"14,-56.14,43.32,97.62",
"15,132.38,-63.57,79.37",
"16,33.99,37.45,-93.82",
"17,63.24,2.34,112.04",
"18,85.03,-71.39,-79.6",
"19,-132.27,83.93,124.78",
"20,119.04,-63.04,173.86",
"21,-109.81,-32.09,-75.22",
"22,-35.09,-26.21,143.18",
"23,26.53,12.15,174.97",
"24,19.18,15.74,-33.14",
"25,119.28,8.61,138.4",
"26,-34.66,-85.28,179.0",
"27,-106.58,-40.98,-23.82",
"28,123.51,-28.53,63.67",
"29,-145.97,-81.63,150.61",
"30,97.82,-35.14,116.46",
"31,50.08,-42.47,81.4",
"32,70.23,-3.98,38.65",
"33,-81.34,-74.66,-92.65",
"34,175.12,39.58,148.24",
"35,-90.97,-20.7,-145.2",
"36,129.85,79.01,169.76",
"37,136.61,15.08,-98.61",
"38,-41.82,-48.7,-103.5",
"39,45.65,-8.83,149.8",
"40,-123.01,13.68,139.82",
"41,128.58,9.18,166.98",
"42,-9.79,49.5,-153.07",
"43,110.97,-21.71,-172.32",
"44,59.78,18.47,74.78",
"45,-153.64,-67.36,-94.26",
"46,41.84,-16.06,15.19",
"47,163.35,-85.52,164.9",
"48,-130.21,-11.41,82.45",
"49,-22.93,20.35,73.41",
"50,16.46,-82.63,-154.05",
"51,-94.03,40.02,162.71",
"52,42.64,14.45,-128.74",
"53,-91.18,-44.61,-152.65",
"54,168.6,30.84,-128.1",
"55,50.71,-20.44,137.77",
"56,-54.02,31.11,-61.05",
"57,137.61,5.3,-100.67",
"58,-24.04,6.99,-162.8",
"59,23.3,-5.93,1.06",
"60,85.75,54.29,-0.46",
"61,168.65,0.27,-67.39",
"62,46.74,35.71,111.03",
"63,125.05,0.47,-128.41",
"64,64.37,-26.94,-127.64",
"65,62.05,63.72,-160.62",
"66,-16.37,2.93,135.74",
"67,-43.03,-38.34,-143.27",
"68,-128.31,-37.82,132.29",
"69,179.51,-83.15,-67.89",
"70,-50.57,-85.61,-143.87",
"71,-44.21,-41.86,-103.06",
"72,-21.21,23.07,33.99",
"73,-154.04,71.21,151.68",
"74,19.88,17.99,95.8",
"75,57.44,-76.72,-64.92",
"76,-43.54,-62.07,118.77",
"77,-112.17,67.13,-122.78",
"78,101.02,13.1,-166.65",
"79,-26.71,53.35,-131.43",
"80,-17.13,70.18,119.26",
"81,-14.33,7.65,133.04",
"82,-14.48,-26.98,100.06",
"83,166.46,16.49,54.42",
"84,150.6,5.6,175.06",
"85,94.83,66.61,177.63",
"86,-10.06,-71.85,41.64",
"87,-46.44,17.51,86.35",
"88,141.39,-73.55,160.07",
"89,94.09,16.02,26.02",
"90,-105.59,46.15,88.79",
"91,-84.2,60.11,171.53",
"92,23.57,11.23,90.16",
"93,3.16,59.18,28.6",
"94,129.17,50.36,7.34",
"95,-100.89,2.18,6.73",
"96,-71.75,72.52,-26.6",
"97,145.85,-48.1,-178.67",
"98,-111.22,26.84,144.52",
"99,-167.84,-42.15,-81.14",
"100,-57.56,19.85,27.41"};

#include <ArduinoBLE.h>

BLEService sensorService("580A");
BLEStringCharacteristic dataChar("580E", BLERead | BLEWrite | BLENotify, 100);
BLEStringCharacteristic commandChar("580F", BLERead | BLEWrite | BLENotify, 100);

void setup(){
  Serial.begin(115200);
  while(!Serial);

  pinMode(LED_BUILTIN, OUTPUT);

  if(!BLE.begin()){
    Serial.println("Starting BLE module failed!");
    while(1);
  }

  BLE.setLocalName("TheraTec Sensor");
  BLE.setAdvertisedService(sensorService);

  sensorService.addCharacteristic(commandChar);
  sensorService.addCharacteristic(dataChar);
  BLE.addService(sensorService);

  BLE.advertise();
  Serial.println("Ready!");
  commandChar.setValue("Ready!");
  // Serial.println(mockdata);
}

void loop(){
  BLEDevice central = BLE.central();

  if(central){
    Serial.print("Connected to central: ");
    Serial.println(central.address());
    while(central.connected()){
      if(commandChar.written()){
        String command = commandChar.value();
        Serial.print("Recieved command: ");
        Serial.println(command);

        // uses the first char in command string
        switch(command[0]){
          case 's':
            // start recording data
            Serial.println("start recording session");
          case 'x':
            // stop recording session
            Serial.println("stop recording session");
          case 'g':
            // send session data over dataChar
            Serial.println("send session data");
            commandChar.setValue("Sending values");
            sendSessionData();
        }
      }
    }
  }
}

void sendSessionData(){
  for(int i=0; i<100; i++){
    Serial.println(mockdata[i]);
    dataChar.writeValue(mockdata[i]);
  }
  commandChar.setValue("done");
}